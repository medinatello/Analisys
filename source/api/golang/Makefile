.PHONY: help install swag run dev test clean

# Variables
BINARY_NAME=edugo-api
MAIN_PATH=./cmd/server
DOCS_PATH=./docs

help: ## Mostrar esta ayuda
	@echo "Comandos disponibles:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

install: ## Instalar dependencias
	@echo "ğŸ“¦ Instalando dependencias..."
	go mod download
	go mod tidy
	@echo "âœ… Dependencias instaladas"

swag: ## Generar documentaciÃ³n Swagger
	@echo "ğŸ“ Generando documentaciÃ³n Swagger..."
	@if ! command -v swag &> /dev/null; then \
		echo "âš ï¸  swag no estÃ¡ instalado. Instalando..."; \
		go install github.com/swaggo/swag/cmd/swag@latest; \
	fi
	swag init -g cmd/server/main.go -o $(DOCS_PATH)
	@echo "âœ… DocumentaciÃ³n Swagger generada en $(DOCS_PATH)"

run: swag ## Ejecutar el servidor
	@echo "ğŸš€ Iniciando servidor..."
	go run $(MAIN_PATH)/main.go

dev: swag ## Ejecutar en modo desarrollo con hot reload
	@echo "ğŸ”¥ Modo desarrollo (hot reload)..."
	@if ! command -v air &> /dev/null; then \
		echo "âš ï¸  air no estÃ¡ instalado. Instalando..."; \
		go install github.com/cosmtrek/air@latest; \
	fi
	air

build: swag ## Compilar el binario
	@echo "ğŸ”¨ Compilando..."
	go build -o bin/$(BINARY_NAME) $(MAIN_PATH)/main.go
	@echo "âœ… Binario compilado en bin/$(BINARY_NAME)"

test: ## Ejecutar tests
	@echo "ğŸ§ª Ejecutando tests..."
	go test -v ./...

clean: ## Limpiar archivos generados
	@echo "ğŸ§¹ Limpiando..."
	rm -rf bin/
	rm -rf $(DOCS_PATH)
	@echo "âœ… Limpieza completada"

docker-build: ## Construir imagen Docker
	@echo "ğŸ³ Construyendo imagen Docker..."
	docker build -t edugo-api:latest .

docker-run: ## Ejecutar en Docker
	@echo "ğŸ³ Ejecutando en Docker..."
	docker run -p 8080:8080 --env-file .env edugo-api:latest
