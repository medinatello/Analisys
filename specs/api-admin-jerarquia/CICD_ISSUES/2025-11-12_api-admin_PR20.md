# CICD Issues - PR #20 - api-administracion

**Fecha:** 12 de Noviembre, 2025  
**PR:** #20 - feature/admin-cicd → dev  
**Workflow:** pr-to-dev.yml  
**Run ID:** 19316753170

---

## Error 1: fmt.Sprintf format type mismatch

**ID:** `ERR-CICD-001-PORT-TYPE`

### Situación
- **Archivo:** `cmd/main.go:138`
- **Error:** `fmt.Sprintf format %s has arg cfg.Server.Port of wrong type int`
- **Contexto:** Primera ejecución de workflows después de configurar CI/CD

### Análisis
El campo `cfg.Server.Port` es de tipo `int` pero se está usando con formato `%s` (string) en fmt.Sprintf.

```go
// Línea 138
Addr: fmt.Sprintf(":%s", cfg.Server.Port),
```

### Solución Propuesta
Cambiar formato de `%s` a `%d` o convertir Port a string.

**Opción 1 (preferida):**
```go
Addr: fmt.Sprintf(":%d", cfg.Server.Port),
```

**Opción 2:**
```go
Addr: fmt.Sprintf(":%s", strconv.Itoa(cfg.Server.Port)),
```

### Solución Aplicada
Opción 1 - Cambiar formato a `%d`

**Razón:** Más simple, sin imports adicionales, correcto semánticamente.

---

## Error 2: golangci-lint exit code 3

**ID:** `ERR-CICD-002-LINT-FAIL`

### Situación
- **Job:** Lint & Format Check
- **Error:** `golangci-lint exit with code 3`
- **Contexto:** Probablemente causado por Error 1 (type mismatch)

### Análisis
golangci-lint detecta el error de tipos en fmt.Sprintf y falla con exit code 3.

### Solución Propuesta
Se resolverá automáticamente al corregir Error 1.

### Solución Aplicada
Corregir Error 1 primero, luego re-ejecutar lint.

---

## Error 3: Coverage file not found

**ID:** `ERR-CICD-003-COVERAGE-PATH`

### Situación
- **Job:** Unit Tests
- **Error:** `ENOENT: no such file or directory, open 'coverage/coverage-filtered.out'`
- **Contexto:** Workflow espera archivo de coverage en path específico

### Análisis
El workflow de api-mobile usa un path de coverage que puede no existir en api-administracion o el test falló antes de generarlo.

### Solución Propuesta
**Opción 1:** Verificar que tests generen el archivo en el path correcto
**Opción 2:** Actualizar workflow para crear carpeta coverage
**Opción 3:** Ignorar error si no es crítico

### Solución Aplicada
Esperar a que Error 1 se resuelva. Si los tests pasan, el coverage se generará automáticamente.

---

## Error 4: No artifacts uploaded

**ID:** `ERR-CICD-004-ARTIFACTS`

### Situación
- **Warning:** `No files were found with the provided path: coverage/`
- **Contexto:** Consecuencia de Error 3

### Análisis
No es crítico, es un warning. Los artifacts de coverage no se suben porque el archivo no existe.

### Solución Aplicada
Se resolverá al corregir errores anteriores.

---

## Resumen de Acciones

1. ✅ Corregir Error 1 (type mismatch en main.go:138)
2. ⏳ Push y esperar re-ejecución de CI/CD
3. ⏳ Verificar que lint pasa (Error 2)
4. ⏳ Verificar que coverage se genera (Error 3-4)

---

_Última actualización: 12 de Noviembre, 2025_


## Error 5: Go Version Inconsistency (RESUELTO)

**ID:** `ERR-CICD-005-GO-VERSION-SHARED`

### Situación
Al intentar corregir Error 1, go mod tidy forzaba upgrade a Go 1.25.4 porque shared/common requería 1.25.3.

### Análisis Profundo
- api-mobile: Go 1.24.10 ✅
- api-admin: Go 1.25.3 ❌
- worker: Go 1.25.3 ❌
- shared: Inconsistente (algunos 1.24, common 1.25) ❌

**Raíz del problema:** Sesiones anteriores estandarizaron en 1.24 por testcontainers, pero shared/common se actualizó inadvertidamente.

### Solución Aplicada

**1. Corregir shared (PR #13):**
- ✅ 10 módulos actualizados a Go 1.24
- ✅ common/go.sum regenerado
- ✅ Releases v0.4.1 creados (auth, bootstrap, common, config, lifecycle, logger)
- ✅ 32/32 checks SUCCESS
- ✅ Mergeado a dev (commit 0fa9a37)

**2. Actualizar api-admin:**
- ✅ go.mod: 1.25.3 → 1.24.10
- ✅ Dependencias: shared v0.4.0 → v0.4.1
- ✅ Compilación local exitosa

### Validación
```bash
go mod tidy  # Se mantiene en 1.24.10 ✅
go build ./...  # Compilación exitosa ✅
```

### Pendiente
- ⏳ worker también está en 1.25.3 - Requiere corrección similar
- ⏳ Crear issue para rastrear fix de worker

---

## Resumen de Correcciones Aplicadas

| Error | Estado | Solución |
|-------|--------|----------|
| ERR-CICD-001 | ✅ RESUELTO | %s → %d en fmt.Sprintf |
| ERR-CICD-002 | ✅ RESUELTO | Corregir Error 1 + errcheck |
| ERR-CICD-003 | ⚠️ PENDIENTE | Coverage path (no crítico) |
| ERR-CICD-004 | ⚠️ PENDIENTE | Artifacts (no crítico) |
| ERR-CICD-005 | ✅ RESUELTO | Go 1.24 en shared + api-admin |

---

_Última actualización: 12 de Noviembre, 2025_

